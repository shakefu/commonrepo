name: "CI"
on:
  pull_request:
  push:
    branches:
      - main
      - 'releases/*'

jobs:
  secret_test:
    runs-on: ubuntu-latest
    steps:
    - run: |
        # secrets.MULTIFIELD_JSON =
        # {
        #   "field1": "value1",
        #   "field2": true,
        #   "field3": {
        #     "subfield": "subfield works",
        #     "floats": 1.234
        #   }
        # }
        echo "Whole JSON: ${{ secrets.MULTIFIELD_JSON }}"
        echo "field1: ${{ fromJson(secrets.MULTIFIELD_JSON).field1 }}"
        echo "field2: ${{ secrets.MULTIFIELD_JSON.field2 }}"
        echo "field3: ${{ secrets.MULTIFIELD_JSON.field3 }}"
        echo "subfield: ${{ secrets.MULTIFIELD_JSON.field3.subfield }}"
        echo "floats: ${{ secrets.MULTIFIELD_JSON.field3.floats }}"
  # unit tests
  units:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: action/
    steps:
    - uses: actions/checkout@v3
    - run: npm ci
    - run: npm test

  # test action works running from the graph
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ./
      with:
        github_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
